<?xml version="1.0"?>
<fastcgi xmlns:xi="http://www.w3.org/2001/XInclude">
<pools>
	<pool name="read" threads="4" queue="16"/>
	<ool name="write" threads="2" queue="16"/>
</pools>
<handlers>
	<handler pool="read" port="80" url="/(download-info|get).*">
		<component name="proxy"/>
	</handler>
	<handler pool="write" port="9000" url="/(upload|delete).*">
		<component name="proxy"/>
	</handler>
	<!-- <handler pool="read" port="80">
		<component name="proxy"/>
	</handler>
	<handler pool="write" port="9000">
		<component name="proxy"/>
	</handler> -->
</handlers>
<components>
    <component name="proxy" type="proxy_module:proxy_factory">
		<!--Logger to use for elliptics HTTP proxy-->
		<logger>daemon-logger</logger>
        <dnet>
            <!-- <cocaine_config>cocaine_config.json</cocaine_config> -->
            <!--Maximum valid number of inaccessible dnet backends-->
            <die-limit>1</die-limit>
            <!--Dnet base port-->
            <base-port>1024</base-port>
            <!--Dnet directory bit number-->
            <directory-bit-num>16</directory-bit-num>
            <!--Dnet logging settings-->
            <log>
                <!--Log file-->
                <!-- <path>/var/log/dnet/dnet.log</path> -->
				<path>/tmp/log/dnet.log</path>
                <!--Log mask-->
                <mask>15</mask>
            </log>
            <!--Secure cookie settings-->
            <cookie>
                <!--Cookie name-->
                <name>cookie_name</name>
                <!--Cookie key-->
                <key>super_secret_key</key>
                <!--Signature key-->
                <sign>mega_secret_key</sign>
                <!--Cookie path-->
                <path>/</path>
                <!--Cookie domain-->
                <domain>.example.com</domain>
                <!--Cookie expiration time-->
                <expires>1209600</expires>
            </cookie>
            <!--Dnet backends list-->
            <remote>
                <addr>localhost:1025:2</addr>
                <!-- <addr>dnet2.example.com:1025:2</addr> -->
                <!-- <addr>dnet3.example.com:1025:2</addr> -->
                <!-- <addr>dnet4.example.com:1025:2</addr> -->
            </remote>
            <!--Dnet groups-->
            <groups>1:2</groups>
            <!--Typemap: file extention -> content type-->
            <typemap>
                <type>xml->text/xml</type>
                <type>jpg->image/jpeg</type>
                <type>txt->text/plain</type>
            </typemap>
            <!--Allow list: what file extentions allowed to download-->
            <allow>
                <extention>txt</extention>
                <extention>jpg</extention>
                <extention>xml</extention>
            </allow>
            <!--Deny list: what file extentions denied to download-->
            <deny>
                <extention>*</extention>
            </deny>
        </dnet>
    </component>
    <component name="daemon-logger" type="logger:logger">
       <level>DEBUG</level>
       <control-uri>/log</control-uri>
        <ident>fastcgi-proxy</ident>
    </component>
</components>
<modules>
    <module name="proxy_module" path="/usr/lib/fastcgi2/libproxy.so"/>
    <module name="logger" path="/usr/lib/fastcgi2/fastcgi2-syslog.so"/>
</modules>
<daemon>
    <logger component="daemon-logger"/>
    <endpoint>
        <backlog>128</backlog>
        <socket>/tmp/fastcgi_daemon.sock</socket>
        <threads>1</threads>
    </endpoint>
    <pidfile>/tmp/fastcgi_daemon.pid</pidfile>
    <monitor_port>20081</monitor_port>
</daemon>
</fastcgi>

